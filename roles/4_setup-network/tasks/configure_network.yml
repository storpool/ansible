---
- name: Include distro-specific tasks
  include_tasks: "subtasks/configure_network_{{ ansible_os_family | lower }}.yml"

- name: Alternative network setup tool
  command: "/usr/local/bin/preconfignet"
  register: preconfignet
  when: sp_alternative_net_setup

- name: Execute net_helper genconfig with provided parameters
- name: Generate config files
  shell: |
   net_helper genconfig \
    {{ interfaces }} \ # this needs to be multiple parameters...
    --sp-mode "{{ sp_mode }}" \
    --vlan {{ vlan if vlan else 0 }}
    --sp-network {{ sp_network }} \ # below are optional (if provided)
    "{{ '--iscsi-mode {{ iscsi_mode }}' if iscsi_mode else '' }}" \
    TODO all the other options, some of which are multi
  register: genconfig_output
  when: not sp_alternative_net_setup
  changed_when: false

- name: TODO check whether there are changes to be applied
  shell: |
    net_helper check --compare /path/to/the/collected/above.conf
  args:
    executable: /bin/bash
  changed_when: false
  when: not sp_alternative_net_setup

- name: TODO execute applyifcfg if necessary
  shell: |
    net_helper applyifcfg --from-config /etc/storpool/autonets.conf
  changed_when: false # this shouldn't be false, I guess
  when: not sp_alternative_net_setup
